<!DOCTYPE>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    
    <title>HKR.注册</title>
    <meta charset="UTF-8">
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="cache-control" content="no-cache">
	<meta http-equiv="expires" content="0">    
	<meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
	<meta http-equiv="description" content="This is my page">
	<link rel="stylesheet" href="/css/register.css"/>
      <link rel="icon" href="favicon.ico">
	<script type="text/javascript" src="/js/jquery-3.2.1.min.js"></script>
	<script type="text/javascript">

        $(document).ready(function(){
        	$.getScript("/js/register/register_box.js");
        	
        	InitCourseShow();

        	 $.extend($.fn.validatebox.defaults.rules,{
       			equals:{
       				validator:function(value,param){
       					return value == $(param[0]).val();
       				},
       				message:"两次密码不一致!"
       			}
       		});
            $.extend($.fn.validatebox.defaults.rules, {   
                  phone: {    //第三步,选中校验谁
                         validator: function(value){    //第四步, 具体编写校验规则
                          var reg = /^1[3,5,7,8][0-9]{9}$/;
                          
                          var flag = reg.test(value);
                       	
                          if(!flag){
                         	 return false;
                          }else{
                         	 var d = {"phoneNumber":$("#reg_phone").val()};
                         	var result = $.ajax({
                         		url:"UserServlet?method=findByPhone",
                         		method:"post",
                         		dataType:"json",
                         		data:JSON.stringify(d),
                         		async:false,
                         		contentType:"application/json;charset=utf-8",
                         		success:function(r){
                         			return false;
                         		}
                         	 });
                         	var json = JSON.parse(result.responseText);
                         	if(!json.status){
                         		$.fn.validatebox.defaults.rules.phone.message = json.msg;
                         		return false;
                         	}else{
                         		return true;
                         	}
                         	
                          }
                         },
                         message: "请输入正确的手机号!"   //第五步,如果输入内容不符合校验规则,出现的提示语.
                     }   
                 });
              
              $("#btn_reg").bind("click",function(){
            	  if(!checkReg()){
            		  return false;
            	  }
            	  if(checkLoginname() && checkEmail()){
            		$.ajax({
            			url:"UserServlet?method=register",
            			dataType:"json",
            			contentType:"application/json;charset=utf-8",
            			data:JSON.stringify($("#msform").serializeJSON()),
            			method:"post",
            			success:function(result){
            				if(!result.status){
            					$.messager.alert("失败",result.msg,"error");
            					return false;
            				}else{
            					$.messager.alert("成功",result.msg,"info");
            					return true;
            				};
            			}
            		});
            	  };
              });
        });
        	
</script>	
  </head>

<form id="msform">
	<!-- progressbar -->
	<ul id="progressbar">
		<li class="active">第一步</li>
		<li>第二步</li>
		<li>第三步</li>
	</ul>
	<!-- fieldsets -->
	<fieldset>
		<h2 class="fs-title">注册账户</h2>
		<h3 class="fs-subtitle">第一步</h3>
		<input type="text" name="loginname" id="loginname" placeholder="系统登录名" class="easyui-validatebox" data-options="required:true"/>
		<input type="text" name="username" placeholder="真实姓名(只能设置一次，后期无法修改)" class="easyui-validatebox" data-options="required:true"/>
		<input type="password" id="pwd" name="password" placeholder="密码" class="easyui-validatebox" data-options="required:true"/>
		<input type="password" name="reloginpass" placeholder="确认密码" class="easyui-validatebox" data-options="required:true" validType="equals['#pwd']"/>
		<input type="button" name="next" class="next action-button" value="下一步" />
	</fieldset>
	<fieldset>
		<h2 class="fs-title">基本信息</h2>
		<h3 class="fs-subtitle">第二步</h3>
		<input type="text" name="age" placeholder="年龄" id="valid_age"  onblur="validateAge()"/>

		
		<select name="sex" class="reg">
			<option value="男">男</option>
			<option value="女">女</option>
		</select>
		
		<select name="classname" id="classname" class="reg">
		
		</select>
		
		<input type="button" name="previous" class="previous action-button" value="上一步" />
		<input type="button" name="next" class="next action-button" value="下一步" />
	</fieldset>
	<fieldset>
		<h2 class="fs-title">联系方式</h2>
		<h3 class="fs-subtitle">第三步</h3>
		<input type="text" name="email" placeholder="邮箱" id="reg_mail" class="easyui-validatebox" data-options="required:true" validType="email"/>
		<input type="text" name="phoneNumber" id="reg_phone" placeholder="电话号码" class="easyui-validatebox" data-options="required:true" validType="phone"/>
		<textarea name="address" placeholder="居住地址" style="resize:none;"></textarea>
		<input type="button" name="previous" class="previous action-button" value="上一步" />
		<input type="submit" name="submit" id="btn_reg" class="submit action-button" value="注册" />
	</fieldset>
</form>


<script src="/js/register/jquery.easing.min.js" type="text/javascript"></script>
<script src="/js/register/register.js" type="text/javascript"></script>
<script src="/js/register/register_box.js" type="text/javascript"></script>
<br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br>
<div style="text-align:center;clear:both">
</div>

</body>
</html>
